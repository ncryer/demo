<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEGES Demo</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.indigo-pink.min.css">
    <link rel="stylesheet" href="style/material.min.css">
    <link rel="stylesheet" href="https://openlayers.org/en/v3.19.0/css/ol.css" type="text/css">
    <link rel="stylesheet" href="node_modules/metrics-graphics/dist/metricsgraphics.css" type="text/css">
    <link rel="stylesheet" href="style/custom.css" />
  </head>

  <body>

    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
      <div class="mdl-layout__drawer">
        <header class="mdl-layout__header">

            <!-- title -->
            <div class="mdl-grid center-items">
              <span class="mdl-layout-title">Indtast addresse eller CVR</span>
            </div>


            <div class="mdl-grid center-items">
              <!-- search box -->
              <form action="#">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                  <input class="mdl-textfield__input" type="text" id="adrField">
                  <label class="mdl-textfield__label" for="sample3">Adresse</label>
                </div>
              </form>

              <form action="#">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                  <input class="mdl-textfield__input" type="text" id="cvrField">
                  <label class="mdl-textfield__label" for="sample3">CVR</label>
                </div>
                <br />
                <br />
                <button id="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                  SÃ¸g
                </button>
              </form>
            </div>





          <div class="mdl-layout__header-column">


          </div>
        </header>
        <span class="mdl-layout-title">Here's something!</span>
      </div>

      <main class="mdl-layout__content">
        <div class="page-content">

          <!-- MAP -->
          <div id="map" class="map"></div>


          <!-- Plot creation appends to this div, so it's gotta be there  -->
          <div id="plotContainer" style="z-index: 9999;"></div>
        </div>
      </main>
    </div>



    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script defer src="https://code.getmdl.io/1.2.1/material.min.js"></script>
    <script src="https://openlayers.org/en/v3.19.0/build/ol.js"></script>
    <script src="libs/defiant.min.js"></script>
    <script src="node_modules/d3/build/d3.js"></script>
    <script src="node_modules/metrics-graphics/dist/metricsgraphics.js"></script>
    <script src="libs/funcs.js"></script>
    <!-- data -->
    <script src="node_modules/sql.js/js/sql.js"></script>
    <script src="node_modules/browserfs/dist/browserfs.js"></script>
    <script>

    var endpointBaseUrl = 'http://localhost:3000'
    // Button logic
    $(document).ready(function(){
      $("#submit").click(function(){
        // Get values from adrField and cvrField
        var adr = $("#adrField").val();
        var cvr = $("#cvrField").val();

        if( adr.length > cvr.length ){
          // Query the address endpoint
          var endpoint = endpointBaseUrl + "/adr";
          $.ajax({
            url:endpoint,
            data: {'adresse':adr},
            success: function(data){
              var test = collectIDs(data);
              console.log(test);
            }
          });
        } else {
          // Query the CVR endpoint
          var endpoint = endpointBaseUrl + "/cvr";
          $.ajax({
            url: endpoint,
            data: {'cvr': cvr},
            success: function(data){
              // Do stuff with data
              var TS = getTimeSeries(data[0]["ID"]);
              
            }
          });
        }


      });
    });


    var layers = [
      // Background map
      new ol.layer.Tile({
        source: new ol.source.OSM()
      }),

      new ol.layer.Tile({
        source: new ol.source.TileWMS({
          url: 'http://dev-geonode.vfltest.dk/geoserver/segesdemo/wms',
          params: {'LAYERS':'segesdemo:adr_marker', 'TILED':true},
          serverType: 'geoserver'
        })
      })
    ];

    var map = new ol.Map({
      layers: layers,
      target: 'map',
      view: new ol.View({
        center: [1100000,7600000],
        zoom: 7
      })
    });

    // var search = getData(3);
    // createPlot(search, "testplot");
    //
    // BrowserFS.install(window);
    // var inmem = new BrowserFS.FileSystem.InMemory();
    // BrowserFS.initialize(inmem);
    //
    // var testdb = loadDB('/data/timeseries.sqlite');

    </script>

  </body>
</html>
